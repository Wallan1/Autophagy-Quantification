---
title: "15-Load-Segmented-Cell-Data"
output: html_notebook
---

CSV import
*change input file path*
```{r}
testdata=read.csv(file="~/Desktop/21Jan21_analysis/NSW3010_Basal_count_29Jan21.csv",header=TRUE)
testdata$BvsS<-"Basal"
testdata$Rep<-1
nobs=nrow(testdata)
for (i in 1:nobs) {
  if (testdata[i,1]=="") {
    testdata[i,1]<-fname

  } 
  else {
    fname=testdata[i,1]

  }
}

testdata2=read.csv(file="~/Desktop/21Jan21_analysis/NSW3010_Starved_count_29Jan21.csv",header=TRUE)
testdata2$BvsS<-"Starved"
testdata2$Rep<-1
nobs=nrow(testdata2)
for (i in 1:nobs) {
  if (testdata2[i,1]=="") {
    testdata2[i,1]<-fname

  } 
  else {
    fname=testdata2[i,1]

  }
}

temp<-rbind(testdata,testdata2)
```

Adding type designation
*if necessary update substring values based on filename in input document*
```{r}
temp$Type<-NA
ntemp<-nrow(temp)


for (c in 1:ntemp) {
  if (substr(temp[c,1],45,45)=="W") {
    temp$Type[c]<-"WT"
  }
  else if (substr(temp[c,1],45,45)=="C") {
    temp$Type[c]<-"Control"
  }
  else if (substr(temp[c,1],45,45)=="t") {
    temp$Type[c]<-"tepsin"
  }
  else {
    temp$Type[c]<-"AP4E1"
  }
  
}
temp$Type<-factor(temp$Type, levels=c("WT", "Control", "tepsin", "AP4E1"))
```

Find files where number of Nuclei does not match number of segmented cells (based on LAMPCellID):

These files should be evaluated to identify images where cells were not segmented properly as all cells should have LAMP1 signal. 
```{r}
ntemp<-nrow(temp)
temp[,2]<-as.numeric(temp[,2])
temp[,5]<-as.numeric(temp[,5])
ncell<-temp[1,2]
rs<-c()
for (i in 1:ntemp) {
  if (!is.na(temp[i,2]) & i!=1) {
    if (ncell!=temp[i-1,5]) {
      rs<-c(rs,i-1)
    }
    ncell<-temp[i,2]
  }
  
  if (i==ntemp){
    if (ncell!=temp[i,5]) {
      rs<-c(rs,i)
    }
  }
}

badcellc<-data.frame(temp[rs,1])
```

It is possible some cells will have no LC3 puncta. But all cells should have LAMP1. This function will replace NA rows in the LC3 Puncta Count column with 0 so they will be acknowledged in the data analysis
```{r}
temp[is.na(temp[,4]),4]<-0
```

Getting average or sum values per cell for LAMP1 metrics
```{r}
ntemp<-nrow(temp)
temp[,6]<-as.numeric(temp[,6])
temp$AveLAMPVolPerCell <- NA
temp$AveLAMPIntPerCell<- NA
temp$AveLAMPSumIntPerCell<-NA
temp$TotLAMPIntPerCell<-NA
rs<-c()
cid<-1
fname<-temp[1,1]
for (i in 1:ntemp) {
  if (!is.na(temp[i,6])){
    if (temp[i,6]!=cid | temp[i,1]!=fname) {
      temp$AveLAMPVolPerCell[rs]<-mean(temp$LAMPObjVol[rs])
      temp$AveLAMPIntPerCell[rs]<-mean(temp$LAMPMeanObjInt[rs])
      temp$AveLAMPSumIntPerCell[rs]<-mean(temp$LAMPSumObjInt[rs])
      temp$TotLAMPIntPerCell[rs]<-sum(temp$LAMPSumObjInt[rs])
      rs<-c(i)
      cid<-temp[i,6]
      fname<-temp[i,1]
    }
    else {
      rs<-c(rs,i)
    }
  }
  if (i==ntemp){
    temp$AveLAMPVolPerCell[rs]<-mean(temp$LAMPObjVol[rs])
    temp$AveLAMPIntPerCell[rs]<-mean(temp$LAMPMeanObjInt[rs])
    temp$AveLAMPSumIntPerCell[rs]<-mean(temp$LAMPSumObjInt[rs])
    temp$TotLAMPIntPerCell[rs]<-sum(temp$LAMPSumObjInt[rs])
  }
}
```